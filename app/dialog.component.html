<div id="top_panel">
	<a (click)="goBack()" id="go_back"> 
		<div id="left_arrow"></div>
		<h1 id="dialog_title">{{title}}</h1>
	</a>
	<button id="send_btn" (click)="sendMessage()">Send</button>
	<button id="mark_as_read_btn" (click)="markAsRead()" [hidden]="!history || !history[0] || history[0].out || history[0].read_state">Mark as read</button>
</div>
<div id="input_box">
	<label id="input_label" for="message_input">Type your text hereâ€¦</label>
	<textarea id="message_input" #minput (click)="clearLabelContent()" (keydown)="onKeyPress($event,minput.value)" [(ngModel)]="current_text"></textarea>
	<div id="hline"></div>
</div>
<div id="chat_body">
	<div class="message_block" *ngFor="let message of history_to_show">
		<div class="user_avatar" [class.online]="message.user.online">
			<a [href]="'https://vk.com/id'+message.user.id" target="_blank">
				<img alt="" [src]="getUserPhoto(message.user.id)" class="user_avatar_img" />
			</a>
		</div>
		<div class="message">
			<div class="user_name_and_date">
				<a [href]="'https://vk.com/id'+message.user.id" target="_blank" class="user_name">{{getUserName(message.user.id)}}</a>
                <span class="message_timestamp">{{message.date*1000 | date:formatDate(message.date) }}</span>
			</div>
			<ul class="messages_list">
				<li class="message_item" *ngFor="let item of message.messages">
					<div class="message_body clearfix">
						<div class="unread" [hidden]="item.read_state"></div>
						<pre class="message_body_internal" [hidden]="!item.body">
{{item.body}}
						</pre>
						<div class="message_attachment" *ngFor="let attachment of getMessageAttachments(item)">
							<div *ngIf="attachment.photo" class="att_photo">
								<img class="att_photo_img zoom_in" #att_photo alt="" [src]="attachment.photo.photo_130" (click)="changePhotoSize(att_photo,attachment.photo)" />
							</div>
							<div *ngIf="attachment.doc" class="clearfix">
								<a class="att_doc_icon" [href]="attachment.doc.url" target="_blank"></a>
								<a class="att_doc" [href]="attachment.doc.url" target="_blank" #att_doc (click)=goToUrl(att_doc.href)>{{attachment.doc.title}}</a>
								<div class="att_doc_size">{{floor(attachment.doc.size/1000)}} KB</div>
							</div>
							<div *ngIf="!attachment.type">
								{{attachment}}
							</div>
						</div>
					</div>
				</li>
			</ul>
		</div>
	</div>
	<div id="load_old" (click)="loadOldMessages()" [hidden]="messages_count && messages_count === history.length">
		<div id="arrow_down"></div>
		<a id="load_old_link">Load previous messages</a>
	</div>
</div>